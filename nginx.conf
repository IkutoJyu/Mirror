#user  nobody;
worker_processes  auto;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
  worker_connections  1024;
}


http {
  include       mime.types;
  default_type  application/octet-stream;

  #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
  #                  '$status $body_bytes_sent "$http_referer" '
  #                  '"$http_user_agent" "$http_x_forwarded_for"';

  # access_log  logs/access.log  main;

  rewrite_log on;
  # error_log    /usr/local/nginx/logs/error.log debug;
  sendfile        on;

  keepalive_timeout  65;

  # for mobile redirect to desktop for reverse
  proxy_redirect https://zh.m.wikipedia.org/ https://mwiki.upupming.site/;
  proxy_redirect https://zh.wikipedia.org/ https://wiki.upupming.site/;

  proxy_cookie_domain zh.wikipedia.org wiki.upupming.site;
  proxy_cookie_domain zh.m.wikipedia.org m.wiki.upupming.site;
  proxy_cookie_domain upload.wikimedia.org upwiki.upupming.site;
  proxy_cookie_domain wikipedia.org wiki.upupming.site;
  proxy_cookie_domain www.google.com google.upupming.site;
  proxy_cookie_domain google.com google.upupming.site;
  proxy_cookie_domain ipv6.google.com google.upupming.site;
  proxy_cookie_domain ipv4.google.com ipv4.google.upupming.site;
  proxy_cookie_domain maps.google.com maps.google.upupming.site;
  proxy_cookie_domain code.google.com code.google.upupming.site;
  proxy_cookie_domain translate.google.com translate.google.upupming.site;
  proxy_cookie_domain docs.google.com docs.google.upupming.site;
  proxy_cookie_domain photos.google.com photos.google.upupming.site;
  proxy_cookie_domain scholar.google.com scholar.google.upupming.site;
  proxy_cookie_domain accounts.google.com accounts.google.upupming.site;

  proxy_set_header User-Agent $http_user_agent;
  proxy_set_header Accept-Encoding "";
  proxy_set_header X-Real-IP $remote_addr; 
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
  proxy_set_header X-Forwarded-Proto https;
  # open as new window, very important! or subs_filter won't work
  # but clients won't be able to change their languages!
  proxy_set_header Cookie "";
  
  # substitute text mime 
  subs_filter_types text/css text/xml application/json;
  # wikipedia replacement
  subs_filter zh.wikipedia.org wiki.upupming.site;
  subs_filter zh.m.wikipedia.org mwiki.upupming.site;
  subs_filter upload.wikimedia.org upwiki.upupming.site;

  # google replacement
  subs_filter www.google.com.hk google.upupming.site;
  subs_filter www.google.com google.upupming.site;
  subs_filter google.com google.upupming.site;

  subs_filter ssl.gstatic.com ssl.gstatic.upupming.site;
  subs_filter gstatic.com gstatic.upupming.site gi;
  subs_filter www.gstatic.com www.gstatic.upupming.site;
  subs_filter cdn.staticfile.org staticfilecdn.upupming.site;

  # header should only be replaced once
  sub_filter_once on;
  # add my styles
  sub_filter <head> '<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114899088-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());

      gtag("config", "UA-114899088-2");
    </script>  
    
    <link rel="stylesheet" type="text/css" href="https://mirror.upupming.site/css/upupming-Mirror.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
  ';

  # add a footer
  subs_filter </body> '
      <div>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:block; text-align:center;"
            data-ad-layout="in-article"
            data-ad-format="fluid"
            data-ad-client="ca-pub-2188191456032650"
            data-ad-slot="1010225698"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        <my-footer style="background-color:white; display: block; margin-top: 30px;">
          <div class="container font-kai" id="about" style="background-color:white">
            <!-- Copyright information-->
            <p style="color:black"><a href="https://mirror.upupming.site/">所有镜像站点</a>在<a href="https://wiki.upupming.site/zh-cn/Wikipedia%3ACC_BY-SA_3.0协议文本">知识共享 署名-相同方式共享 3.0协议</a>之条款下提供</p>
            <ul class="list-inline" style="display: inline-block;">
              <li class="list-inline-item">
                <a href="https://upupming.site" style="color:#4ba8e9">Blog</a>
              </li>
              <li class="list-inline-item">
                <a href="https://github.com/upupming/" style="color:#4ba8e9">GitHub</a>
              </li>
              <li class="list-inline-item">
                <a href="mailto:upupming@gmail.com" style="color:#4ba8e9">E-mail</a>
              </li>
            </ul>

            <!-- busuanzi -->
            <div class="busuanzi" style="color:black"><script async="" src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" style="display: inline;"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" style="display: inline;"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div>

          </div>
        </my-footer>
      </div>
    </body>';
  
  ##### Wikipedia desktop
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name wiki.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name wiki.upupming.site;
    listen 443 ssl;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      proxy_pass https://zh.wikipedia.org;    

      subs_filter 'role="main">' 'role="main">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:block; text-align:center;"
            data-ad-layout="in-article"
            data-ad-format="fluid"
            data-ad-client="ca-pub-2188191456032650"
            data-ad-slot="1010225698"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      ';

      subs_filter '手机版视图</a></li>' '手机版视图</a></li>
        <div>
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <ins class="adsbygoogle"
              style="display:block; text-align:center;"
              data-ad-layout="in-article"
              data-ad-format="fluid"
              data-ad-client="ca-pub-2188191456032650"
              data-ad-slot="1010225698"></ins>
          <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
          <my-footer style="background-color:white; display: block; margin-top: 30px;">
            <div class="container font-kai" id="about" style="background-color:white">
              <!-- Copyright information-->
              <p style="color:black"><a href="https://mirror.upupming.site/">所有镜像站点</a>在<a href="https://wiki.upupming.site/zh-cn/Wikipedia%3ACC_BY-SA_3.0协议文本">知识共享 署名-相同方式共享 3.0协议</a>之条款下提供</p>
              <ul class="list-inline" style="display: inline-block;">
                <li class="list-inline-item">
                  <a href="https://upupming.site" style="color:#4ba8e9">Blog</a>
                </li>
                <li class="list-inline-item">
                  <a href="https://github.com/upupming/" style="color:#4ba8e9">GitHub</a>
                </li>
                <li class="list-inline-item">
                  <a href="mailto:upupming@gmail.com" style="color:#4ba8e9">E-mail</a>
                </li>
              </ul>

              <!-- busuanzi -->
              <div class="busuanzi" style="color:black"><script async="" src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" style="display: inline;"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" style="display: inline;"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div>

            </div>
          </my-footer>
        </div>';
        subs_filter zh.m.wikipedia.org mwiki.upupming.site;
    }
    location https://zh.wikipedia.org/ {
        return 301 https://wiki.upupming.site$request_uri;
    }
    location https://zh.m.wikipedia.org/ {
        return 301 https://mwiki.upupming.site$request_uri;
    }
  }
  ##### Wikipedia mobile
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name mwiki.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name mwiki.upupming.site;
    listen 443 ssl;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      proxy_pass https://zh.m.wikipedia.org;

      subs_filter 'class="mw-body">' 'class="mw-body">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:block; text-align:center;"
            data-ad-layout="in-article"
            data-ad-format="fluid"
            data-ad-client="ca-pub-2188191456032650"
            data-ad-slot="1010225698"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      ';
          
      subs_filter '桌面版</a></li>' '桌面版</a></li>
        <div>
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <ins class="adsbygoogle"
              style="display:block; text-align:center;"
              data-ad-layout="in-article"
              data-ad-format="fluid"
              data-ad-client="ca-pub-2188191456032650"
              data-ad-slot="1010225698"></ins>
          <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
          <my-footer style="background-color:white; display: block; margin-top: 30px;">
            <div class="container font-kai" id="about" style="background-color:white">
              <!-- Copyright information-->
              <p style="color:black"><a href="https://mirror.upupming.site/">所有镜像站点</a>在<a href="https://wiki.upupming.site/zh-cn/Wikipedia%3ACC_BY-SA_3.0协议文本">知识共享 署名-相同方式共享 3.0协议</a>之条款下提供</p>
              <ul class="list-inline" style="display: inline-block;">
                <li class="list-inline-item">
                  <a href="https://upupming.site" style="color:#4ba8e9">Blog</a>
                </li>
                <li class="list-inline-item">
                  <a href="https://github.com/upupming/" style="color:#4ba8e9">GitHub</a>
                </li>
                <li class="list-inline-item">
                  <a href="mailto:upupming@gmail.com" style="color:#4ba8e9">E-mail</a>
                </li>
              </ul>

              <!-- busuanzi -->
              <div class="busuanzi" style="color:black"><script async="" src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" style="display: inline;"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" style="display: inline;"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div>

            </div>
          </my-footer>
        </div>';
      subs_filter zh.wikipedia.org wiki.upupming.site;
    }
    location https://zh.m.wikipedia.org/{
      rewrite ^/(.*) https://mwiki.upupming.site/$1 permanent;
    }
    location https://zh.wikipedia.org/{
      rewrite ^/(.*) https://wiki.upupming.site/$1 permanent;
    }
  }
  ##### Wikipedia upload
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name upwiki.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name upwiki.upupming.site;
    listen 443 ssl;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;
    
    location / {
      proxy_pass https://upload.wikimedia.org;
    }

    location https://zh.m.wikipedia.org/{
      rewrite ^/(.*) https://mwiki.upupming.site/$1 permanent;
    }
    location https://zh.wikipedia.org/{
      rewrite ^/(.*) https://wiki.upupming.site/$1 permanent;
    }
  }



  ##### Google search(using ipv6)
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name google.upupming.site;
      listen 80;	
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443;
    server_name google.upupming.site;
    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;
    
    location / {	
      proxy_pass https://ipv6.google.com;
    }
    location /maps {
      proxy_pass https://www.google.com/maps;
    }
  }
  ##### Google ipv4
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name ipv4.google.upupming.site;
      listen 80;	
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443;
    server_name ipv4.google.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      proxy_pass https://ipv4.google.com;
    }

    location /maps {
      proxy_pass https://www.google.com/maps;
    }        
  }
  ##### Google gstatic
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name gstatic.upupming.site;
      listen 80;	
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443;
    server_name gstatic.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      proxy_pass https://gstatic.com;
    }
  }
  ##### Google www.gstatic
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name www.gstatic.upupming.site;
      listen 80;	
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443;
    server_name www.gstatic.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      proxy_pass https://www.gstatic.com;
    }
  }
  ##### Google ssl.gstatic
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name ssl.gstatic.upupming.site;
      listen 80;	
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443;
    server_name ssl.gstatic.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      proxy_pass https://ssl.gstatic.com;
    }
  }
  ##### Google encrypted-tbn0.gstatic
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name encrypted-tbn0.gstatic.upupming.site;
      listen 80;	
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443;
    server_name encrypted-tbn0.gstatic.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      proxy_pass https://encrypted-tbn0.gstatic.com;
    }
  }
  ##### gstatic subdomains
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    # Support subdomain
    server_name "~^(.+)\.gstatic\.upupming\.site$";
    
    ssl on;
    ssl_certificate /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
      resolver 8.8.8.8;
      set $originaddr https://$1.gstatic.com;
      proxy_pass $originaddr;
    }
  }
  ##### Google scholar
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name scholar.google.upupming.site;
    listen 80;
    return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name scholar.google.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        proxy_pass https://scholar.google.com;
    }
  }
  ##### Google accounts
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name accounts.google.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name accounts.google.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        proxy_pass https://accounts.google.com;
    }
  }
  ##### Google maps
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name maps.google.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name maps.google.upupming.site;

    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        return 301 https://google.upupming.site/maps;
    }
  }
  ##### Google Translate
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name translate.google.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name translate.google.upupming.site;

    ssl on;
    ssl_certificate /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        proxy_pass https://translate.google.com;
    }
  }
  ##### Google Photos
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name photos.google.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name photos.google.upupming.site;

    ssl on;
    ssl_certificate /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        proxy_pass https://photos.google.com;
    }
  }
  ##### Google Docs
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name docs.google.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name docs.google.upupming.site;

    ssl on;
    ssl_certificate /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        proxy_pass https://docs.google.com;
    }
  }
  ##### Google Code
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name code.google.upupming.site;
    listen 80;
    return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name code.google.upupming.site;

    ssl on;
    ssl_certificate /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        proxy_pass https://code.google.com;
    }
    location /codejam/ {
        proxy_pass https://code.google.com/codejam/;
    }
  }
  ##### Other Google subdomains
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    # Support subdomain
    server_name "~^(.+)\.google\.upupming\.site$";
    listen 80;
    
    return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
      listen 443 ssl;
    # Support subdomain
    server_name "~^(.+)\.google\.upupming\.site$";
    
    ssl on;
    ssl_certificate /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        resolver 8.8.8.8;
        set $originaddr https://$1.google.com;
        proxy_pass $originaddr;
    }
  }


  ##### upupming Mirror
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name mirror.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name mirror.upupming.site;

    ssl on;
    ssl_certificate /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    location / {
        root /home/wwwroot/Mirror;
        index index.html index.htm;
    }
  }




  ##### gitea
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name git.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name git.upupming.site;

    
    
    # git push
    client_max_body_size 50m;
    
    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;
    
    location / {
        proxy_pass http://localhost:3000;
    }
  }



 ##### files
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name files.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name files.upupming.site;

    
    
    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;
    
    location / {
        proxy_pass http://localhost:4000;
    }
  }
 ##### class6
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    server_name class6.upupming.site;
    listen 80;
      return 301 https://$server_name$request_uri;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen 443 ssl;
    server_name class6.upupming.site;
    
    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;

    client_max_body_size 50m;        

    root /var/www/class6;
            
    location / {
        index  index.php index.html index.htm;
        autoindex on;
    }
    location ~ \.php$ {
        try_files $uri =404;
        include /etc/nginx/fastcgi_params;

        fastcgi_pass    php;
        fastcgi_index   index.php;
        fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param   HTTP_HOST       $server_name;
    }
    location ~* \.docx$ {
        deny all;
    }
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen  443 ssl;
    ssl on;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;
    ssl_protocols         TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers           HIGH:!aNULL:!MD5;
    server_name           v2ray.upupming.site;
    location /ray {
        proxy_redirect off;
        proxy_pass http://127.0.0.1:9813;#假设WebSocket监听在环回地址的9813端口上
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $http_host;
    }
  }

  # shorten url
  # Upstream to abstract backend connection(s) for php
  upstream php {
    server unix:/run/php/php7.2-fpm.sock;
    server 127.0.0.1:9000;
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen       80;
    root         /var/www/polr/public;
    index        index.php index.html index.htm;
    server_name  s.upupming.site; # Or whatever you want to use

    return 301 https://$server_name$request_uri; 
    # Forces HTTPS, which enables privacy for login credentials.
    # Recommended for public, internet-facing, websites.

    location / {
      try_files $uri $uri/ /index.php$is_args$args;
      # rewrite ^/([a-zA-Z0-9]+)/?$ /index.php?$1;
    }

    location ~ \.php$ {
      try_files $uri =404;
      include /etc/nginx/fastcgi_params;

      fastcgi_pass    unix:/var/run/php/php7.2-fpm.sock;
      fastcgi_index   index.php;
      fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;
      fastcgi_param   HTTP_HOST       $server_name;
    }
  }
  server {
    location = /robots.txt { return 200 "User-agent: *\nDisallow: /\n"; }
    listen               443 ssl;
    ssl_certificate      /etc/letsencrypt/live/upupming.site/fullchain.pem;
    ssl_certificate_key  /etc/letsencrypt/live/upupming.site/privkey.pem;
    root                /var/www/polr/public;
    index index.php index.html index.htm;
    server_name         s.upupming.site;

    

    location / {
      try_files $uri $uri/ /index.php$is_args$args;
      # rewrite ^/([a-zA-Z0-9]+)/?$ /index.php?$1;
    }
    location ~ \.php$ {
      try_files $uri =404;
      include /etc/nginx/fastcgi_params;

      fastcgi_pass    php;
      fastcgi_index   index.php;
      fastcgi_param   SCRIPT_FILENAME $document_root$fastcgi_script_name;
      fastcgi_param   HTTP_HOST       $server_name;
    }
  }
}
